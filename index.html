<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cat√°logo Relojes</title>

<style>
body{
  font-family: Arial;
  margin:110px 20px 20px 20px;
}

/* ===== TOP BAR ===== */
#topbar{
  position:fixed;
  top:0; left:0; right:0;
  background:#222;
  color:#fff;
  padding:10px;
  display:flex;
  align-items:center;
  gap:10px;
  z-index:1000;
}
#topbar button{ padding:6px 12px; cursor:pointer; }
#resumen{ margin-left:auto; font-weight:bold; }

/* ===== BUSCADOR ===== */
#buscador{
  padding:6px;
  width:200px;
}

/* ===== GRID ===== */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:12px;
}
.card{
  border:1px solid #ccc;
  padding:10px;
  text-align:center;
}
.codigo{
  background:#bfe6ff;
  font-weight:bold;
  padding:4px;
}
.card img{
  max-width:100%;
  height:140px;
  object-fit:contain;
  margin:6px 0;
  transition:transform .3s;
}
.card:hover img{
  transform:scale(1.5);
  z-index:2;
}
.precio{
  font-weight:bold;
  text-align:center;
  margin:6px 0;
}
input[type=number]{ width:70px; }
.seleccionado{ background:orange; }

/* ===== MODAL CARRITO ===== */
#modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:2000;
}
#modalContent{
  background:#fff;
  width:90%;
  max-width:600px;
  margin:80px auto;
  padding:15px;
}
#cerrar{
  float:right;
  cursor:pointer;
  font-size:18px;
}

/* ===== TABLA ===== */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ccc;
  padding:6px;
  text-align:center;
}

/* ===== BOTON ARRIBA ===== */
#volverArriba{
  position:fixed;
  right:15px;
  bottom:20px;
  font-size:36px;
  cursor:pointer;
  background:#222;
  color:#fff;
  padding:10px 14px;
  border-radius:50%;
  display:none;
  z-index:1500;
}
</style>
</head>

<body>

<!-- ===== TOP BAR ===== -->
<div id="topbar">
  <strong>üì¶ Cat√°logo</strong>
  <input id="buscador" placeholder="Buscar modelo..." oninput="filtrar()">
  <button onclick="exportar()">üíæ Guardar Excel</button>
  <button onclick="abrirCarrito()">üõí Ver carrito</button>
  <div id="resumen">Cantidad: 0 | Total: $ 0.00</div>
</div>

<h2>Datos del pedido</h2>
Raz√≥n Social:<br><input id="razon"><br><br>
Fecha:<br><input type="date" id="fecha"><br><br>
Observaciones:<br><textarea id="obs" rows="3"></textarea>

<hr>

<div id="estado"></div>
<div id="catalogo" class="grid"></div>

<!-- ===== MODAL ===== -->
<div id="modal">
  <div id="modalContent">
    <span id="cerrar" onclick="cerrarCarrito()">‚ùå</span>
    <h3>üõí Carrito</h3>
    <div id="lista">Vac√≠o</div>
  </div>
</div>

<div id="volverArriba" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚¨Ü</div>

<script>
let productos=[], carrito=[];

/* ===== CARGA AUTOMATICA ===== */
window.onload=()=>{
  fetch("stock.csv")
    .then(r=>r.text())
    .then(t=>cargarCSV(t))
    .catch(()=>estado.innerText="No se pudo cargar stock");
};

function cargarCSV(txt){
  txt=txt.replace(/\r/g,"").trim();
  let filas=txt.split("\n");
  filas.shift();
  filas.forEach((f,i)=>{
    let c=f.split(";");
    if(c.length<2) return;
    productos.push({
      id:i,
      codigo:c[0].trim(),
      precio:parseFloat(c[1].replace(",",".")),
      img:"FOTOS/"+c[0].trim()+".jpg"
    });
  });
  dibujar(productos);
}

function dibujar(lista){
  catalogo.innerHTML="";
  lista.forEach(p=>{
    catalogo.innerHTML+=`
    <div class="card">
      <div class="codigo">${p.codigo}</div>
      <img src="${p.img}" onerror="this.style.display='none'">
      <div class="precio">$ ${p.precio.toFixed(2)}</div>
      <input type="number" min="0" value="0"
        id="q${p.id}" onchange="cambiar(${p.id})">
    </div>`;
  });
}

function cambiar(id){
  let q=document.getElementById("q"+id);
  let cant=parseInt(q.value)||0;
  let p=productos.find(x=>x.id===id);
  carrito=carrito.filter(x=>x.id!==id);
  if(cant>0){
    carrito.push({id,codigo:p.codigo,cant,precio:p.precio});
    q.classList.add("seleccionado");
  }else q.classList.remove("seleccionado");
  mostrarCarrito();
  resumenTotal();
}

function mostrarCarrito(){
  if(!carrito.length){ lista.innerText="Vac√≠o"; return; }
  let t=0,h="<table><tr><th>C√≥digo</th><th>Cant</th><th>Precio</th><th>Sub</th></tr>";
  carrito.forEach(i=>{
    let s=i.cant*i.precio; t+=s;
    h+=`<tr><td>${i.codigo}</td><td>${i.cant}</td><td>${i.precio}</td><td>${s.toFixed(2)}</td></tr>`;
  });
  h+=`<tr><td colspan="3"><b>Total</b></td><td><b>${t.toFixed(2)}</b></td></tr></table>`;
  lista.innerHTML=h;
}

function resumenTotal(){
  let c=0,t=0;
  carrito.forEach(i=>{c+=i.cant;t+=i.cant*i.precio;});
  resumen.innerText=`Cantidad: ${c} | Total: $ ${t.toFixed(2)}`;
}

function abrirCarrito(){ modal.style.display="block"; mostrarCarrito(); }
function cerrarCarrito(){ modal.style.display="none"; }

function filtrar(){
  let v=buscador.value.toLowerCase();
  dibujar(productos.filter(p=>p.codigo.toLowerCase().includes(v)));
}

function exportar(){
  if(!carrito.length){ alert("Carrito vac√≠o"); return; }
  let csv="PEDIDO RELOJES CASIO\n\n";
  csv+=`Razon Social;${razon.value}\nFecha;${fecha.value}\nObs;${obs.value}\n\n`;
  csv+="Codigo;Cantidad;Precio\n";
  carrito.forEach(i=>csv+=`${i.codigo};${i.cant};${i.precio}\n`);
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv]));
  a.download="pedido.csv";
  a.click();
}

window.addEventListener("scroll",()=>{
  volverArriba.style.display=window.scrollY>300?"block":"none";
});
</script>

</body>
</html>
